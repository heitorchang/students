{% load static %}
{% include "ui/header.html" %}

Students:
<ul>
  <li v-for="s in students">{s.name}
  <a :href="'/ui/students/' + s.id + '/'">Edit</a>
  <button @click="deleteStudent(s.id)">Delete {s.id}</button>
</ul>

<br>
Add Student:<br>

{% include "ui/studentform.html" %}
<button @click="addStudent">Add</button>
  
{% include "ui/commonscripts.html" %}

let vapp = new Vue({
  delimiters: ['{', '}'],

  el: "#app",

  data: {
    students: [],
    newName: "",
    newPhone: "",
    newEmail: "",
    newWeekday: "",
    newTime: "",
  },

  methods: {
    addStudent() {
      axios
        .post('{% url "records:student_list" %}',
              { teacher: {{ request.user.id }},
                name: this.newName,
                phone: this.newPhone,
                email: this.newEmail,
                lesson_weekday: this.newWeekday,
                lesson_time: this.newTime,
              })
        .then(response => {
          console.log(response.data);
          this.students.push(response.data);
        });
          
    },
    deleteStudent(id) {
      axios
        .delete('/records/students/' + id + '/')
        .then(response => {
          console.log("Delete: " + response.statusText);
          this.students = this.students.filter(e => e.id !== id);
        });
    }

  },
  
  mounted () {
    axios
      .get('{% url "records:student_list" %}')
      .then(response => {
        console.log("Get list: " + response.statusText);
        this.students = response.data;
      });
  }
});

{% include "ui/footer.html" %}
